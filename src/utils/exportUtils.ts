import jsPDF from 'jspdf';
import autoTable from 'jspdf-autotable';
import * as XLSX from 'xlsx';
import { FinalInvoice, ProformaInvoice, DeliveryNote, Client } from '@/types';
import { fetchCompanyInfo } from '@/components/exports/CompanyInfoHeader';
import n2words from 'n2words';
import { mockDataService } from '@/services/mockDataService';

export const convertNumberToFrenchWords = (num: number): string => {
  return n2words(num, { lang: 'fr' });
};
function toTitleCase(str) {
  return str.replace(/\w\S*/g, (txt) =>
    txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase()
  );
}

function formatCurrencyInFrenchWords(amount: number): string {
  const euros = Math.floor(amount);
  const cents = Math.round((amount - euros) * 100);

  const eurosText = euros === 0 ? 'zéro euro' : `${n2words(euros, { lang: 'fr' })} ${euros > 1 ? 'Dinar Algerien' : 'Dinar Algerien'}`;
  const centsText =
    cents === 0
      ? ''
      : `et ${n2words(cents, { lang: 'fr' })} ${cents > 1 ? 'centimes' : 'centime'}`;

  return `${eurosText} ${centsText}`.trim();
}

// Helper for formatting currency

const formatCurrency = (amount: number) => {
  // Format the number with thousand separators and decimal places
  const formatted = amount.toFixed(2)
    .replace('.', ',')
    .replace(/\B(?=(\d{3})+(?!\d))/g, '.');
  
  return formatted + ' DA';
};

// Helper for formatting dates
const formatDate = (dateString: string) => {
  return new Date(dateString).toLocaleDateString('fr-DZ');
};

// Draw rounded rectangle with fill and border
const drawRoundedRect = (pdf: jsPDF, x: number, y: number, width: number, height: number, radius: number, fill: string, stroke?: string) => {
  pdf.setFillColor(hexToRgb(fill).r, hexToRgb(fill).g, hexToRgb(fill).b);
  
  if (stroke) {
    pdf.setDrawColor(hexToRgb(stroke).r, hexToRgb(stroke).g, hexToRgb(stroke).b);
    pdf.setLineWidth(0.5);
  }
  
  // Draw rounded rectangle
  pdf.roundedRect(x, y, width, height, radius, radius, stroke ? 'FD' : 'F');
};

// Convert hex to RGB
const hexToRgb = (hex: string) => {
  const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex.trim());
  return result ? {
    r: parseInt(result[1], 16),
    g: parseInt(result[2], 16),
    b: parseInt(result[3], 16)
  } : { r: 0, g: 0, b: 0 };
};

// Add common header with logo and company info
const addHeader = async (pdf: jsPDF, documentType: string, documentNumber: string, status: string, invoiceDetails: any, ) => {
  // Fetch company info from database
  const companyInfo = await fetchCompanyInfo();
  const logoBase641= 'data:image/jpeg;base64,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'; 
   
  //  Colors
  const primaryColor = "#1D3557";  // Blue
  const secondaryColor = "#6366F1"; // Indigo
  const accentColor = "#F59E0B";   // Amber
  const lightGray = "#F3F4F6";     // Light gray for background
  const darkGray = "#374151";      // Dark gray for text
  if (logoBase641) {
      try {
        // Add logo to the left of the company name
        pdf.addImage(logoBase641, 'JPEG', 1, 5, 180, 40); // Adjust dimensions as needed
      } catch (error) {
        console.error('Error adding logo:', error);
      }
    }
  // Add colored header banner
  const gradientHeight = 2;

  pdf.setFillColor(hexToRgb(primaryColor).r, hexToRgb(primaryColor).g, hexToRgb(primaryColor).b);
  pdf.rect(0, 0, pdf.internal.pageSize.width, gradientHeight, 'F');
  pdf.rect( 0 ,  295, pdf.internal.pageSize.width, 1, 'F');

  pdf.rect( 0 ,  295, pdf.internal.pageSize.width, gradientHeight, 'F');
  // Add company name in large font with custom positioning
  pdf.setFont("times", "bolditalic");
  pdf.setTextColor(29, 53, 87);
  pdf.setFontSize(22);

  //pdf.text(companyInfo?.businessName || 'YOUR COMPANY NAME', 30, 17);
    pdf.setFont("helvetica", "bold");
  pdf.setFontSize(16);
  //pdf.text('Sable industriel de l\'EST', 30, 22);

  // Add smaller company details below the name
  pdf.setFont("helvetica", "normal");
  pdf.setFontSize(9);
  pdf.setTextColor(70, 70, 70);
  
  const companyDetails = [
    `${companyInfo?.address || 'Company Address'}  `,
    `RC: ${companyInfo?.commerceRegNumber || 'N/A'}`,
    `NIF: ${companyInfo?.taxid || 'N/A'}`,
    `NIS: 002004020004183`, `RIB: 00300325000240230052 Badr agence Ain Beida`,
    
  ];
  
  pdf.text(companyDetails, 14, 27);
  pdf.setDrawColor(70,70,70);
      pdf.line(
        12,
        48,
        200,
        48
      );
  // Add document type in a styled box on the right
  pdf.setFillColor(hexToRgb(primaryColor).r, hexToRgb(primaryColor).g, hexToRgb(primaryColor).b);
  pdf.setTextColor(255, 255, 255);
  pdf.setFont("helvetica", "bold");
  pdf.setFontSize(12);
  const isCreditNote = documentNumber.toLowerCase().includes("fd");

  const cleanedNumber = isCreditNote
    ? documentNumber.replace(/FD/gi, "").trim()
    : documentNumber;

  const docTypeText = isCreditNote
    ? `${documentType.toUpperCase()} D'AVOIR N°: ${cleanedNumber}     Date: ${formatDate(invoiceDetails.issuedate)}`
    : `${documentType.toUpperCase()} N°: ${documentNumber}     Date: ${formatDate(invoiceDetails.issuedate)}`;
    
 // const docTypeText = documentNumber.toLowerCase().includes("fd")  ? `${documentType.toUpperCase()} D'AVOIR N°: ${documentNumber}`  : `${documentType.toUpperCase()} N°: ${documentNumber}`;


 // const docTypeText = `${documentType.toUpperCase()} N°: ${documentNumber}`;
  const docTypeWidth = pdf.getStringUnitWidth(docTypeText) * 12 / pdf.internal.scaleFactor;
  const docTypeX = pdf.internal.pageSize.width - 14 - docTypeWidth - 10; // 10 = padding
  const docTypeXX = 14;
  const docTypeYY = 50;
     // Amber color for thank you
  
 

  drawRoundedRect(pdf, docTypeXX, docTypeYY, docTypeWidth + 10, 10, 2, primaryColor);
  pdf.text(docTypeText, docTypeXX + 5, docTypeYY + 7);
  
  pdf.setFont("helvetica");
  pdf.setFontSize(8);
  pdf.setTextColor(70, 70, 70);
  pdf.text(`Addresse: ${companyInfo?.address || 'Company Address'} \n Tél: ${companyInfo?.phone || 'N/A'} | Email: ${companyInfo?.email || 'info@company.com'}`, 105, pdf.internal.pageSize.height - 20, { align: 'center' });

  return { yPos: docTypeYY+16, companyInfo };
};

// Add client info section with styled design
const addClientInfo = (pdf: jsPDF, client: Client | undefined, invoiceDetails: any, startY: number) => {
  pdf.setTextColor(70, 70, 70);
  pdf.setFontSize(11);
    // Colors
  const lightBlue = "#f8edeb";  // Light blue background 
  const darkBlue = "#E63946";   // Dark blue for accent
  const darkGray = "#374151";   // Dark gray for text
  const borderColor = "#1D3557"; 
  // Client section box with light blue background
  drawRoundedRect(pdf, 14, startY, 180, 40, 3, lightBlue,borderColor);
  
  // Left side: Client info
  pdf.setTextColor(borderColor);
  pdf.setFontSize(11);
  pdf.setFont("helvetica", "bold");
  pdf.text(`Client: ${String(client?.name)?.toUpperCase() ?? 'Client Name'}`, 20, startY + 7);
  
  // Client details
  pdf.setTextColor(darkGray);
  pdf.setFontSize(10);
  pdf.setFont("helvetica", "normal");
  
  const clientInfo = [
    
    `Address: ${client?.address || 'Address'}`,
    client?.rc && `RC: ${client?.rc || '-'}`,
    client?.taxid && `NIF: ${client.taxid}`,
    client?.city && `TIN: ${client?.city || '-'}`,
    client?.nis && `NIS: ${client?.nis || '-'}`,
    client?.ai && `AI: ${client?.ai || '-'}`,
    client?.rib && `RIB: ${client?.rib || '-'} `
    
  ].filter(Boolean);
  
  pdf.text(clientInfo, 20, startY + 13);
  
  // Right side: Invoice details
  /*
  pdf.setTextColor(darkBlue);
  pdf.setFontSize(11);
  pdf.setFont("helvetica", "bold");
  pdf.text("Information de la facture:", 115, startY + 7);
  */
  // Create array of invoice details
  pdf.setTextColor(darkGray);
  pdf.setFont("helvetica", "normal");
  pdf.setFontSize(10);
  
  const details = [
    client?.phone && `Tel: ${client?.phone || 'N/A'} `, 
    client?.email && `Email: ${client?.email || 'N/A'}`,
    `${invoiceDetails.deliverydate === null ? '' : `Mode de paiment: ${invoiceDetails.payment_type === 'cash' ? 'Espèce' : 'Cheque/virment'}`}`,
    `Livraison / remarque : ${invoiceDetails.notes || ' ' }`,
    invoiceDetails?.bc && `B.C: ${invoiceDetails.bc || ' ' }`,
  ].filter(Boolean);
  
  pdf.text(details, 115, startY + 13);
  
  return startY + 45; // Return next Y position
};

// Helper for adding stylized table
const addStylizedTable = (pdf: jsPDF, headers: string[], rows: any[][], startY: number) => {
  const primaryColor = "#3B82F6";  // Blue
  const lightGray = "#F9FAFB";     // Very light gray for alternating rows
  
  autoTable(pdf, {
    startY: startY,
    head: [headers],
    body: rows,
    headStyles: {
      fillColor: [29, 53, 87], // primaryColor in RGB
      textColor: [255, 255, 255],
      fontStyle: 'bold',
      lineWidth: 0.2,
      lineColor: [41, 98, 255]
    },
    bodyStyles: {
      fontSize: 8,
      lineWidth: 0.1,
      lineColor: [220, 220, 220]
    },
    alternateRowStyles: {
      fillColor: [241, 250, 238] // lightGray in RGB
    },
    margin: { left: 14, right: 14 },
    didDrawPage: function(data) {
      
      
      // Add subtle footer line
      pdf.setDrawColor(220, 220, 220);
      pdf.line(
        data.settings.margin.left,
        pdf.internal.pageSize.height - 15,
        pdf.internal.pageSize.width - data.settings.margin.right,
        pdf.internal.pageSize.height - 15
      );
    }
  });
  
  return (pdf as any).lastAutoTable.finalY;
};

// Add totals section with styled design
const addTotals = (pdf: jsPDF, invoice: any, startY: number, tdiscount: number) => {
  const primaryColor = "#003049";  // Blue
  const lightGray = "#f8edeb";     // Light gray for background
  const darkGray = "#374151";      // Dark gray for text
  const borderColor = "#1D3557"; 

  // Draw totals container with light gray background
  drawRoundedRect(pdf, pdf.internal.pageSize.width - 80, startY, 66, 50, 3, lightGray,borderColor);
  
  // Add totals
  pdf.setFont("helvetica", "normal");
  pdf.setTextColor(darkGray);
  pdf.setFontSize(9);
  pdf.text("Remise:", pdf.internal.pageSize.width - 75, startY + 10);
  pdf.text("Total HT:", pdf.internal.pageSize.width - 75, startY + 17);
  pdf.text("TVA:", pdf.internal.pageSize.width - 75, startY + 24);
  
  let nextY = startY + 30;
  
  // Add stamp tax line if applicable invoice.payment_type === 'cash' && invoice.stamp_tax > 0
  if (true) {
    pdf.text("Droit de timbre:", pdf.internal.pageSize.width - 75, nextY);
    pdf.text(`${formatCurrency(invoice.stamp_tax) || '-'}`, pdf.internal.pageSize.width - 20, nextY, { align: 'right' });
    nextY += 10;
  }
  
  // Draw separator line above total
  pdf.setDrawColor(hexToRgb(darkGray).r, hexToRgb(darkGray).g, hexToRgb(darkGray).b);
  pdf.line(pdf.internal.pageSize.width - 75, nextY - 2, pdf.internal.pageSize.width - 15, nextY - 2);
  
  // Add total amount in larger, bold font
  pdf.setFont("helvetica", "bold");
  pdf.setTextColor(hexToRgb(primaryColor).r, hexToRgb(primaryColor).g, hexToRgb(primaryColor).b);
  pdf.setFontSize(12);
  pdf.text("Total TTC:", pdf.internal.pageSize.width - 75, nextY + 5);
  
  // Add the amount values aligned to the right
  pdf.setFont("helvetica", "normal");
  pdf.setTextColor(darkGray);
  pdf.setFontSize(9);
  pdf.text(formatCurrency(tdiscount), pdf.internal.pageSize.width - 20, startY + 10, { align: 'right' });
  pdf.text(formatCurrency(invoice.subtotal), pdf.internal.pageSize.width - 20, startY + 17, { align: 'right' });
  pdf.text(formatCurrency(invoice.taxTotal), pdf.internal.pageSize.width - 20, startY + 24, { align: 'right' });
  
  // Add total with primary color
  pdf.setFont("helvetica", "bold");
  pdf.setTextColor(hexToRgb(primaryColor).r, hexToRgb(primaryColor).g, hexToRgb(primaryColor).b);
  pdf.setFontSize(12);
  pdf.text(formatCurrency(invoice.total), pdf.internal.pageSize.width - 20, nextY + 5, { align: 'right' });
  
  return nextY + 22;
};

// Add notes section with styled design
const addNotes = (pdf: jsPDF, notes: string | undefined, startY: number) => {
  if (true) return startY;
  
  const lightYellow = "#FEF9C3";  // Light yellow for note background
  const darkBrown = "#78350F";    // Dark brown for note text
  
  // Notes title
  pdf.setFont("helvetica", "bold");
  pdf.setFontSize(10);
  pdf.setTextColor(darkBrown);
  pdf.text("NOTES:", 14, startY + 5);
  
  // Notes content
  pdf.setFont("helvetica", "normal");
  pdf.setFontSize(9);
  
  // Draw light yellow background
  drawRoundedRect(pdf, 14, startY + 7, 180, 20, 3, lightYellow);
  
  // Split notes into lines to fit the page width
  const splitNotes = pdf.splitTextToSize(notes, 170);
  pdf.text(splitNotes, 19, startY + 15);
  
  return startY + 33;
};

const addAmountInWords = (pdf: jsPDF, amount: number, startY: number) => {
  const lightGreen = "#457B9D";  // Light green background
  const darkGreen = "#003049";   // Text color
  
  // Set font properties first to calculate text width
  pdf.setFont("helvetica", "bold");
  pdf.setFontSize(9);
  
  // Generate the text
  const totalInWords = formatCurrencyInFrenchWords(amount);
  const fullText = `| ${totalInWords}.`;
  
  // Calculate text width
  const textWidth = pdf.getStringUnitWidth(fullText) * 9 / pdf.internal.scaleFactor;
  
  // Set rectangle dimensions
  const padding = 10; // 5px padding on each side
  const rectWidth = textWidth + padding;
  const rectHeight = 19;
  
  // Draw backgroun d (now with dynamic width)
//  drawRoundedRect(pdf, 14, startY, rectWidth, rectHeight, 3, lightGreen);
  pdf.setDrawColor(220, 220, 220);
  //pdf.line(        rectWidth,startY + 9,rectHeight,        startY + 9);
  // Add text (centered in the rectangle)
  pdf.setTextColor(darkGreen);
  pdf.text(`Montant en lettres:`, 14 + (rectWidth / 2) - (textWidth / 2), startY + 7);
  pdf.line(rectWidth,startY + 9, rectHeight ,startY + 9);
  pdf.text(toTitleCase(fullText), 14 + (rectWidth / 2) - (textWidth / 2), startY + 13);
  
  return startY + rectHeight + 3; // Return new Y position with some margin
};

// Add footer with thank you message
const addFooter = (pdf: jsPDF) => {
  
};
 
// PROFORMA INVOICE EXPORT
export const exportProformaInvoiceToPDF = async (proforma: ProformaInvoice) => {
  const pdf = new jsPDF();

  const maxRowsPerPage = 5;
  const chunkArray = <T>(arr: T[], size: number): T[][] =>
    Array.from({ length: Math.ceil(arr.length / size) }, (_, i) => arr.slice(i * size, i * size + size));

  // Chunked item rows
  let counter = 0;
  const itemRows = proforma.items.map(item => [
    (++counter).toString(),
    item.product?.code.toString(),
    `${item.product?.name || ''}\n${item.product?.description || ''}`,
    item.quantity.toString(),
    item.unit ? item.unit.toString() : '-',
    formatCurrency(item.unitprice),
    `${item.taxrate}%`,
    formatCurrency(item.totalExcl),
  ]);
  const tdiscount = proforma.items.reduce((acc, item) => acc + (item.discount || 0), 0);
  const itemChunks = chunkArray(itemRows, maxRowsPerPage);

  let currentY = 3;
  let pageIndex = 0;
  let lastTableY = 0;

  for (const chunk of itemChunks) {
    if (pageIndex > 0) pdf.addPage();

    const { yPos } = await addHeader(pdf, "FACTURE PROFORMA", proforma.number, proforma.status, proforma);
    currentY = yPos;
    currentY = addClientInfo(pdf, proforma.client, proforma, yPos);


    const tableY = addStylizedTable(
      pdf,
      ['No', 'code' , 'Produit', 'Qté', 'Unité', 'Prix unitaire', 'TVA %',  'Prix HT'],
      chunk,
      currentY + 3
    );
    lastTableY = tableY;
    let yAfterTable = lastTableY + 10;
    const totalsY = addTotals(pdf, proforma, yAfterTable,tdiscount);
    const wordsY = addAmountInWords(pdf, proforma.total, yAfterTable +15);
    const notesY = addNotes(pdf, proforma.notes, wordsY);
    
    pageIndex++;
  }

  // Add page numbers
  const pageCount = pageIndex;
  for (let i = 1; i <= pageCount; i++) {
    pdf.setPage(i);
    pdf.setFontSize(8);
    pdf.setTextColor(100, 100, 100);
    pdf.text(`Page ${i} of ${pageCount}`, 105, pdf.internal.pageSize.height - 10, { align: 'center' });
  }
  // Totals, amount in words, and notes go on last page
 

  addFooter(pdf);
  pdf.save(`Proforma_${proforma.number}.pdf`);
  return true;
};


// FINAL INVOICE EXPORT
export const exportFinalInvoiceToPDF = async (invoice: FinalInvoice) => {
  
  const deliveryNotes = await mockDataService.getDeliveryNotesByFinalInvoiceId(invoice.id);
  const pdf = new jsPDF();

  const maxRowsPerPage = 5;
  const chunkArray = <T>(arr: T[], size: number): T[][] =>
    Array.from({ length: Math.ceil(arr.length / size) }, (_, i) => arr.slice(i * size, i * size + size));

  // Prepare item rows
  let counter = 0;
  const itemRows = invoice.items.map(item => [
    (++counter).toString(),
    item.product?.code.toString(),
    `${item.product?.name || ''}\n${item.product?.description || ''}`,
    item.quantity.toString(),
    item.unit ? item.unit.toString() : '-',
    formatCurrency(item.unitprice),
    formatCurrency(item.totalExcl)
  ]);
  const tdiscount = invoice.items.reduce((acc, item) => acc + (item.discount || 0), 0);
  const itemChunks = chunkArray(itemRows, maxRowsPerPage);
  let currentY = 3;
  let pageIndex = 0;
  let lastTableY = 0;
  let notesYY =0;

  for (const chunk of itemChunks) {
    if (pageIndex > 0) pdf.addPage();

    const { yPos } = await addHeader(pdf, "FACTURE ", invoice.number, invoice.status, invoice);
    currentY = yPos;

    if (pageIndex === 0) {
      currentY = addClientInfo(pdf, invoice.client, invoice, yPos);
    }

    const tableY = addStylizedTable(
      pdf,
      ['No', 'code' , 'Produit', 'Qté', 'Unité', 'Prix unitaire',  'Prix HT'],
      chunk,
      currentY + 3
    );

    lastTableY = tableY;
    let yAfterTable = lastTableY + 10;
    const totalsY = addTotals(pdf, invoice, yAfterTable,tdiscount);
    const wordsY = addAmountInWords(pdf, invoice.total, yAfterTable +15);
    const notesY = addNotes(pdf, invoice.notes, wordsY);
    notesYY = wordsY;
    if (deliveryNotes && deliveryNotes.length > 0) {
        let yPosition=yAfterTable;
        pdf.setFontSize(12);
        pdf.setFont('helvetica');
        pdf.text('Bons de livraison associés:', 20, yPosition);
        yPosition += 5;
        
        pdf.setFontSize(10);
        pdf.setFont('helvetica', 'normal');
        
        // Create a string with all delivery note numbers separated by commas
        const deliveryNoteNumbers = deliveryNotes.map(note => note.number).join(', ');
        
        // Display just the numbers
        pdf.text(deliveryNoteNumbers, 20, yPosition);
        
        // Update yPosition for next content
    }
    pageIndex++;
  }

  // On last page: totals, words, notes, payments
  
  

  addFooter(pdf);
  pdf.save(`Invoice_${invoice.number}.pdf`);
  return true;
};


// DELIVERY NOTE EXPORT
export const exportDeliveryNoteToPDF = async (deliveryNote: DeliveryNote) => {
  const pdf = new jsPDF();

  const maxRowsPerPage = 5;
  const chunkArray = <T>(arr: T[], size: number): T[][] =>
    Array.from({ length: Math.ceil(arr.length / size) }, (_, i) => arr.slice(i * size, i * size + size));

  // Prepare table data
  let counter = 0;
  const itemRows = deliveryNote.items.map(item => [
    (++counter).toString(),
    item.product?.code.toString(),
    `${item.product?.name || 'N/A'}\n${item.product?.description || ''}`,
    item.quantity.toString(),
    item.unit ? item.unit.toString() : 'N/A'
  ]);
  const itemChunks = chunkArray(itemRows, maxRowsPerPage);

  const primaryColor = "#3B82F6";
  const lightPurple = "#EEF2FF";
  const darkPurple = "#4F46E5";

  let currentY = 10;
  let pageIndex = 0;
  let lastTableY = 0;

  for (const chunk of itemChunks) {
    if (pageIndex > 0) pdf.addPage();

    const { yPos } = await addHeader(pdf, "BON DE LIVRAISON", deliveryNote.number, deliveryNote.status , deliveryNote);
    currentY = yPos;
    currentY = addClientInfo(pdf, deliveryNote.client, deliveryNote, yPos);

   
    const tableY = addStylizedTable(
      pdf,
      ['No','code', 'Produit', 'Quantité', 'Unité'],
      chunk,
      currentY + 4
    );

    lastTableY = tableY;
     // Add transport details
    if (deliveryNote.drivername || deliveryNote.truck_id || deliveryNote.delivery_company) {
      const pdfFontSize = 9;
      const linePadding = 5;
      const rowSpacing = 4;

      pdf.setFont("helvetica", "normal");
      pdf.setFontSize(pdfFontSize);

      const labels = ["Entreprise de transport","Chauffeur","N° permi","N° tel", "Matricule" ];
      const values = [
        deliveryNote.delivery_company || "-",
        deliveryNote.drivername || "-",
        deliveryNote.driverlisence || "-",
        deliveryNote.drivertel || "-",
        deliveryNote.truck_id || "-",
        
      ];

      // Measure max width of label and value
      const labelWidths = labels.map(label => pdf.getTextWidth(label));
      const valueWidths = values.map(value => pdf.getTextWidth(value));

      const maxLabelWidth = Math.max(...labelWidths);
      const maxValueWidth = Math.max(...valueWidths);

      const col1Width = maxLabelWidth + linePadding;
      const col2Width = maxValueWidth + linePadding;

      const tableWidth = col1Width + col2Width + 5;
      const tableHeight = (labels.length * rowSpacing) + 6;

      const boxX = 14;
      const boxY = lastTableY +7;

      // Draw background box
      drawRoundedRect(pdf, boxX, boxY, tableWidth, tableHeight, 3, lightPurple);

      // Add title
      
      
      
      

      // Draw content rows
      pdf.setFont("helvetica", "normal");
      pdf.setFontSize(pdfFontSize);
      pdf.setTextColor(0, 0, 0);

      labels.forEach((label, i) => {
        const rowY = boxY + 6 + (i * rowSpacing);
        pdf.text(label, boxX + 2, rowY);
        pdf.text(values[i], boxX + col1Width + 2, rowY);
      });

      currentY = tableHeight + 10;
    }
      // Add notes and signature on last page
    const notesY = addNotes(pdf, deliveryNote.notes, currentY + 10);
    const signatureY = lastTableY + currentY +5;

    pdf.setFont("helvetica", "normal");
    pdf.setFontSize(10);
    pdf.setTextColor(59, 130, 246);

    // Signature lines
    
    
    drawRoundedRect(pdf, 14, signatureY, 60, 40, 3,'#FFFFFF' ,'#003049');

    pdf.text("Recu par:", 30, signatureY + 10);
    

    pageIndex++;
  }

  
  addFooter(pdf);
  pdf.save(`DeliveryNote_${deliveryNote.number}.pdf`);
  return true;
};


// ETAT 104 REPORT EXPORTS
interface ClientSummary {
  clientid: string;
  clientName: string;
  taxid: string;
  subtotal: number;
  taxTotal: number;
  total: number;
}

export const exportEtat104ToPDF = async (
  clientSummaries: ClientSummary[], 
  year: string, 
  month: string,
  totalAmount: number,
  totalTax: number,
  grandTotal: number
) => {
  const pdf = new jsPDF();
  
  // Add company header
  const companyInfo = await fetchCompanyInfo();
  
  // Define colors for report
  const primaryColor = "#3B82F6";  // Blue
  const secondaryColor = "#6366F1"; // Indigo
  
  // Add colored header banner
  const gradientHeight = 15;
  pdf.setFillColor(hexToRgb(primaryColor).r, hexToRgb(primaryColor).g, hexToRgb(primaryColor).b);
  pdf.rect(0, 0, pdf.internal.pageSize.width, gradientHeight, 'F');
  
  // Add company name
  pdf.setFont("helvetica", "bold");
  pdf.setTextColor(50, 50, 50);
  pdf.setFontSize(18);
  pdf.text(companyInfo?.businessName || 'YOUR COMPANY NAME', 105, 25, { align: 'center' });
  
  // Add company details
  pdf.setFont("helvetica", "normal");
  pdf.setFontSize(10);
  pdf.setTextColor(70, 70, 70);
  
  const companyDetails = [
    companyInfo?.address || 'Company Address',
    `NIF: ${companyInfo?.taxid || 'N/A'} | RC: ${companyInfo?.commerceRegNumber || 'N/A'}`,
    `Tel: ${companyInfo?.phone || 'N/A'} | Email: ${companyInfo?.email || 'info@company.com'}`
  ];
  
  pdf.text(companyDetails, 105, 30, { align: 'center' });
  
  // Add report title
  pdf.setFont("helvetica", "bold");
  pdf.setFontSize(16);
  pdf.setTextColor(hexToRgb(primaryColor).r, hexToRgb(primaryColor).g, hexToRgb(primaryColor).b);
  pdf.text(`ÉTAT 104 REPORT - ${month}/${year}`, 105, 50, { align: 'center' });
  
  // Add report subtitle
  pdf.setFont("helvetica", "italic");
  pdf.setFontSize(12);
  pdf.setTextColor(100, 100, 100);
  pdf.text('TVA de mois', 105, 58, { align: 'center' });
  
  // Prepare table data
  const tableRows = clientSummaries.map(summary => [
    summary.clientName,
    summary.taxid,
    formatCurrency(summary.subtotal),
    formatCurrency(summary.taxTotal),
    formatCurrency(summary.total)
  ]);
  
  // Add totals row with bold styling
  tableRows.push([
    'TOTALS',
    '',
    formatCurrency(totalAmount),
    formatCurrency(totalTax),
    formatCurrency(grandTotal)
  ]);
  
  // Add data table
  const tableY = addStylizedTable(
    pdf,
    ['Client', 'NIF', 'Montant (HT)', 'TVA', 'Total'],
    tableRows,
    70
  );
  
  // Add summary section with styled box
  const summaryY = tableY + 20;
  
  // Draw summary box with light background
  drawRoundedRect(pdf, 40, summaryY, 130, 60, 3, "#F0F9FF"); // Light blue background
  
  pdf.setFont("helvetica", "bold");
  pdf.setFontSize(14);
  pdf.setTextColor(hexToRgb(primaryColor).r, hexToRgb(primaryColor).g, hexToRgb(primaryColor).b);
  pdf.text('resumé État 104', 105, summaryY + 10, { align: 'center' });
  
  pdf.setFont("helvetica", "normal");
  pdf.setFontSize(11);
  pdf.setTextColor(70, 70, 70);
  
  const detailsY = summaryY + 20;
  pdf.text('Total vente (Excl. Tax):', 60, detailsY);
  pdf.text('Total TVA :', 60, detailsY + 10);
  pdf.text('Total TVA  (simulé):', 60, detailsY + 20);
  
  // Draw separator line
  pdf.setDrawColor(200, 200, 200);
  pdf.line(60, detailsY + 25, 150, detailsY + 25);
  
  // TVA due
  pdf.setFont("helvetica", "bold");
  pdf.setTextColor(hexToRgb(primaryColor).r, hexToRgb(primaryColor).g, hexToRgb(primaryColor).b);
  pdf.text('TVA Due:', 60, detailsY + 35);
  
  // Add amount values
  pdf.setFont("helvetica", "normal");
  pdf.setTextColor(70, 70, 70);
  pdf.text(formatCurrency(totalAmount), 150, detailsY, { align: 'right' });
  pdf.text(formatCurrency(totalTax), 150, detailsY + 10, { align: 'right' });
  pdf.text(formatCurrency(totalTax * 0.3), 150, detailsY + 20, { align: 'right' });
  
  // Add TVA due amount
  pdf.setFont("helvetica", "bold");
  pdf.setTextColor(hexToRgb(primaryColor).r, hexToRgb(primaryColor).g, hexToRgb(primaryColor).b);
  pdf.text(formatCurrency(totalTax * 0.7), 150, detailsY + 35, { align: 'right' });
  
  // Add compliance note
  pdf.setFont("helvetica", "italic");
  pdf.setFontSize(9);
  pdf.setTextColor(100, 100, 100);
  pdf.text('Note: This report is fully compliant with the Algerian tax authority requirements for G50 declarations.', 
    105, 
    summaryY + 70, 
    { align: 'center' }
  );
  
  // Add date of generation
  const today = new Date().toLocaleDateString('fr-DZ');
  pdf.setFont("helvetica", "normal");
  pdf.setFontSize(8);
  pdf.text(`Generated on: ${today}`, 105, pdf.internal.pageSize.height - 20, { align: 'center' });
  
  // Add page numbers
  const pageCount = pdf.internal.getNumberOfPages();
  for (let i = 1; i <= pageCount; i++) {
    pdf.setPage(i);
    pdf.setFontSize(8);
    pdf.setTextColor(100, 100, 100);
    pdf.text(`Page ${i} of ${pageCount}`, 105, pdf.internal.pageSize.height - 10, { align: 'center' });
  }
  
  // Save the PDF
  pdf.save(`Etat104_${month}_${year}.pdf`);
  return true;
};

export const exportEtat104ToExcel = (
  clientSummaries: ClientSummary[], 
  year: string, 
  month: string,
  totalAmount: number,
  totalTax: number,
  grandTotal: number
) => {
  // Prepare data for Excel
  const data = clientSummaries.map(summary => ({
    'Client': summary.clientName,
    'NIF': summary.taxid,
    'Montant (HT)': summary.subtotal,
    'TVA': summary.taxTotal,
    'Total': summary.total
  }));
  
  // Add totals row
  data.push({
    'Client': 'TOTALS:',
    'NIF': '',
    'Montant (HT)': totalAmount,
    'TVA': totalTax,
    'Total': grandTotal
  });
  
  // Create summary sheet data
  const summaryData = [
    { 'Summary': 'Total vente (HT):', 'Value': totalAmount },
    { 'Summary': 'Total TVA :', 'Value': totalTax },
    { 'Summary': 'Total TVA  (simule):', 'Value': totalTax * 0.3 },
    { 'Summary': 'TVA Due:', 'Value': totalTax * 0.7 }
  ];
  
  // Create workbook and worksheets
  const wb = XLSX.utils.book_new();
  
  // Main data sheet
  const ws = XLSX.utils.json_to_sheet(data);
  XLSX.utils.book_append_sheet(wb, ws, 'État 104 Data');
  
  // Summary sheet
  const summaryWs = XLSX.utils.json_to_sheet(summaryData);
  XLSX.utils.book_append_sheet(wb, summaryWs, 'Summary');
  
  // Save Excel file
  XLSX.writeFile(wb, `Etat104_${month}_${year}.xlsx`);
  return true;
};

// Helper function for status colors
function getStatusColor(status: string): string {
  switch (status) {
    case 'payé':
    case 'approved':
    case 'livrée':
      return "#22C55E"; // Green
    case 'NonPayé':
    case 'sent':
    case 'en_attente_de_livraison':
      return "#3B82F6"; // Blue
    case 'annulé':
    case 'rejected':
      return "#EF4444"; // Red
    case 'credited':
    case 'draft':
    default:
      return "#94A3B8"; // Gray
  }
}

// Helper function to open a new window with HTML content for printing
export const openPrintableInvoice = (
  invoiceType: 'final' | 'proforma',
  invoiceId: string
) => {
  // Open a new tab/window with the printable invoice route - using v3 version
  const url = `/print/v3/${invoiceType}/${invoiceId}`;
  window.open(url, '_blank');
};