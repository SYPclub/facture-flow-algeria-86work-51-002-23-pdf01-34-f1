import jsPDF from 'jspdf';
import autoTable from 'jspdf-autotable';
import * as XLSX from 'xlsx';
import { FinalInvoice, ProformaInvoice, DeliveryNote, Client } from '@/types';
import { fetchCompanyInfo } from '@/components/exports/CompanyInfoHeader';
import n2words from 'n2words';
import { mockDataService } from '@/services/mockDataService';

export const convertNumberToFrenchWords = (num: number): string => {
  return n2words(num, { lang: 'fr' });
};
function toTitleCase(str) {
  return str.replace(/\w\S*/g, (txt) =>
    txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase()
  );
}

function formatCurrencyInFrenchWords(amount: number): string {
  const euros = Math.floor(amount);
  const cents = Math.round((amount - euros) * 100);

  const eurosText = euros === 0 ? 'zÃ©ro euro' : `${n2words(euros, { lang: 'fr' })} ${euros > 1 ? 'Dinar Algerien' : 'Dinar Algerien'}`;
  const centsText =
    cents === 0
      ? ''
      : `et ${n2words(cents, { lang: 'fr' })} ${cents > 1 ? 'centimes' : 'centime'}`;

  return `${eurosText} ${centsText}`.trim();
}

// Helper for formatting currency

const formatCurrency = (amount: number) => {
  // Format the number with thousand separators and decimal places
  const formatted = amount.toFixed(2)
    .replace('.', ',')
    .replace(/\B(?=(\d{3})+(?!\d))/g, '.');
  
  return formatted + ' DA';
};

// Helper for formatting dates
const formatDate = (dateString: string) => {
  return new Date(dateString).toLocaleDateString('fr-DZ');
};

// Draw rounded rectangle with fill and border
const drawRoundedRect = (pdf: jsPDF, x: number, y: number, width: number, height: number, radius: number, fill: string, stroke?: string) => {
  pdf.setFillColor(hexToRgb(fill).r, hexToRgb(fill).g, hexToRgb(fill).b);
  
  if (stroke) {
    pdf.setDrawColor(hexToRgb(stroke).r, hexToRgb(stroke).g, hexToRgb(stroke).b);
    pdf.setLineWidth(0.5);
  }
  
  // Draw rounded rectangle
  pdf.roundedRect(x, y, width, height, radius, radius, stroke ? 'FD' : 'F');
};

// Convert hex to RGB
const hexToRgb = (hex: string) => {
  const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex.trim());
  return result ? {
    r: parseInt(result[1], 16),
    g: parseInt(result[2], 16),
    b: parseInt(result[3], 16)
  } : { r: 0, g: 0, b: 0 };
};

// Add common header with logo and company info
const addHeader = async (pdf: jsPDF, documentType: string, documentNumber: string, status: string, invoiceDetails: any, ) => {
  // Fetch company info from database
  const companyInfo = await fetchCompanyInfo();
  const logoBase641= 'data:image/jpeg;base64,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'; 
   
  //  Colors
  const primaryColor = "#1D3557";  // Blue
  const secondaryColor = "#6366F1"; // Indigo
  const accentColor = "#F59E0B";   // Amber
  const lightGray = "#F3F4F6";     // Light gray for background
  const darkGray = "#374151";      // Dark gray for text
  if (logoBase641) {
      try {
        // Add logo to the left of the company name
        pdf.addImage(logoBase641, 'JPEG', 12, 3, 180, 40); // Adjust dimensions as needed
      } catch (error) {
        console.error('Error adding logo:', error);
      }
    }
  // Add colored header banner
  const gradientHeight = 2;

  pdf.setFillColor(hexToRgb(primaryColor).r, hexToRgb(primaryColor).g, hexToRgb(primaryColor).b);
  pdf.rect(0, 0, pdf.internal.pageSize.width, gradientHeight, 'F');
  pdf.rect( 0 ,  295, pdf.internal.pageSize.width, 1, 'F');

  pdf.rect( 0 ,  295, pdf.internal.pageSize.width, gradientHeight, 'F');
  // Add company name in large font with custom positioning
  pdf.setFont("times", "bolditalic");
  pdf.setTextColor(29, 53, 87);
  pdf.setFontSize(22);

  //pdf.text(companyInfo?.businessName || 'YOUR COMPANY NAME', 30, 17);
    pdf.setFont("helvetica", "bold");
  pdf.setFontSize(16);
  //pdf.text('Sable industriel de l\'EST', 30, 22);

  // Add smaller company details below the name
  pdf.setFont("helvetica", "normal");
  pdf.setFontSize(9);
  pdf.setTextColor(70, 70, 70);
  
  const companyDetails = [
    
    
     `RC: ${companyInfo?.commerceRegNumber || 'N/A'} - NIF: ${companyInfo?.taxid || 'N/A'} - NIS: 002004020004183 - RIB: 00300325000240230052`,
    
  ];
  
  pdf.text(companyDetails, 40, 45);
  pdf.setDrawColor(70,70,70);
      pdf.line(
        12,
        48,
        200,
        48
      );
  // Add document type in a styled box on the right
  pdf.setFillColor(hexToRgb(primaryColor).r, hexToRgb(primaryColor).g, hexToRgb(primaryColor).b);
  pdf.setTextColor(255, 255, 255);
  pdf.setFont("helvetica", "bold");
  pdf.setFontSize(12);
  const isCreditNote = documentNumber.toLowerCase().includes("fd");

  const cleanedNumber = isCreditNote
    ? documentNumber.replace(/FD/gi, "").trim()
    : documentNumber;

  const docTypeText = isCreditNote
    ? `${documentType.toUpperCase()} D'AVOIR NÂ°: ${cleanedNumber}     Date: ${formatDate(invoiceDetails.issuedate)}`
    : `${documentType.toUpperCase()} NÂ°: ${documentNumber}     Date: ${formatDate(invoiceDetails.issuedate)}`;
    
 // const docTypeText = documentNumber.toLowerCase().includes("fd")  ? `${documentType.toUpperCase()} D'AVOIR NÂ°: ${documentNumber}`  : `${documentType.toUpperCase()} NÂ°: ${documentNumber}`;


 // const docTypeText = `${documentType.toUpperCase()} NÂ°: ${documentNumber}`;
  const docTypeWidth = pdf.getStringUnitWidth(docTypeText) * 12 / pdf.internal.scaleFactor;
  const docTypeX = pdf.internal.pageSize.width - 14 - docTypeWidth - 10; // 10 = padding
  const docTypeXX = 14;
  const docTypeYY = 50;
     // Amber color for thank you
  
 

  drawRoundedRect(pdf, docTypeXX, docTypeYY, docTypeWidth + 10, 10, 2, primaryColor);
  pdf.text(docTypeText, docTypeXX + 5, docTypeYY + 7);
  
  pdf.setFont("helvetica");
  pdf.setFontSize(8);
  pdf.setTextColor(70, 70, 70);
  pdf.text(`Addresse: ${companyInfo?.address || 'Company Address'} \n TÃ©l: ${companyInfo?.phone || 'N/A'} | Email: ${companyInfo?.email || 'info@company.com'}`, 105, pdf.internal.pageSize.height - 20, { align: 'center' });

  return { yPos: docTypeYY+16, companyInfo };
};

// Add client info section with styled design
const addClientInfo = (pdf: jsPDF, client: Client | undefined, invoiceDetails: any, startY: number) => {
  pdf.setTextColor(70, 70, 70);
  pdf.setFontSize(11);
    // Colors
  const lightBlue = "#f8edeb";  // Light blue background 
  const darkBlue = "#E63946";   // Dark blue for accent
  const darkGray = "#374151";   // Dark gray for text
  const borderColor = "#1D3557"; 
  // Client section box with light blue background
  drawRoundedRect(pdf, 14, startY, 180, 40, 3, lightBlue,borderColor);
  
  // Left side: Client info
  pdf.setTextColor(borderColor);
  pdf.setFontSize(11);
  pdf.setFont("helvetica", "bold");
  pdf.text(`Client: ${String(client?.name)?.toUpperCase() ?? 'Client Name'}`, 20, startY + 7);
  
  // Client details
  pdf.setTextColor(darkGray);
  pdf.setFontSize(10);
  pdf.setFont("helvetica", "normal");
  
  const clientInfo = [
    
    `Address: ${client?.address || 'Address'}`,
    client?.rc && `RC: ${client?.rc || '-'}`,
    client?.taxid && `NIF: ${client.taxid}`,
    client?.city && `TIN: ${client?.city || '-'}`,
    client?.nis && `NIS: ${client?.nis || '-'}`,
    client?.ai && `AI: ${client?.ai || '-'}`,
    client?.rib && `RIB: ${client?.rib || '-'} `
    
  ].filter(Boolean);
  
  pdf.text(clientInfo, 20, startY + 13);
  
  // Right side: Invoice details
  /*
  pdf.setTextColor(darkBlue);
  pdf.setFontSize(11);
  pdf.setFont("helvetica", "bold");
  pdf.text("Information de la facture:", 115, startY + 7);
  */
  // Create array of invoice details
  pdf.setTextColor(darkGray);
  pdf.setFont("helvetica", "normal");
  pdf.setFontSize(10);
  
  const details = [
    client?.phone && `Tel: ${client?.phone || 'N/A'} `, 
    client?.email && `Email: ${client?.email || 'N/A'}`,
    `${invoiceDetails.deliverydate === null ? '' : `Mode de paiment: ${invoiceDetails.payment_type === 'cash' ? 'EspÃ¨ce' : 'Cheque/virment'}`}`,
    `Livraison / remarque : ${invoiceDetails.notes || ' ' }`,
    invoiceDetails?.bc && `B.C: ${invoiceDetails.bc || ' ' }`,
  ].filter(Boolean);
  
  pdf.text(details, 115, startY + 13);
  
  return startY + 45; // Return next Y position
};

// Helper for adding stylized table
const addStylizedTable = (pdf: jsPDF, headers: string[], rows: any[][], startY: number) => {
  const primaryColor = "#3B82F6";  // Blue
  const lightGray = "#F9FAFB";     // Very light gray for alternating rows
  
  autoTable(pdf, {
    startY: startY,
    head: [headers],
    body: rows,
    headStyles: {
      fillColor: [29, 53, 87], // primaryColor in RGB
      textColor: [255, 255, 255],
      fontStyle: 'bold',
      lineWidth: 0.2,
      lineColor: [41, 98, 255]
    },
    bodyStyles: {
      fontSize: 8,
      lineWidth: 0.1,
      lineColor: [220, 220, 220]
    },
    alternateRowStyles: {
      fillColor: [241, 250, 238] // lightGray in RGB
    },
    margin: { left: 14, right: 14 },
    didDrawPage: function(data) {
      
      
      // Add subtle footer line
      pdf.setDrawColor(220, 220, 220);
      pdf.line(
        data.settings.margin.left,
        pdf.internal.pageSize.height - 15,
        pdf.internal.pageSize.width - data.settings.margin.right,
        pdf.internal.pageSize.height - 15
      );
    }
  });
  
  return (pdf as any).lastAutoTable.finalY;
};

// Add totals section with styled design
const addTotals = (pdf: jsPDF, invoice: any, startY: number, tdiscount: number) => {
  const primaryColor = "#003049";  // Blue
  const lightGray = "#f8edeb";     // Light gray for background
  const darkGray = "#374151";      // Dark gray for text
  const borderColor = "#1D3557"; 

  // Draw totals container with light gray background
  drawRoundedRect(pdf, pdf.internal.pageSize.width - 80, startY, 66, 50, 3, lightGray,borderColor);
  
  // Add totals
  pdf.setFont("helvetica", "normal");
  pdf.setTextColor(darkGray);
  pdf.setFontSize(9);
  pdf.text("Remise:", pdf.internal.pageSize.width - 75, startY + 10);
  pdf.text("Total HT:", pdf.internal.pageSize.width - 75, startY + 17);
  pdf.text("TVA:", pdf.internal.pageSize.width - 75, startY + 24);
  
  let nextY = startY + 30;
  
  // Add stamp tax line if applicable invoice.payment_type === 'cash' && invoice.stamp_tax > 0
  if (true) {
    pdf.text("Droit de timbre:", pdf.internal.pageSize.width - 75, nextY);
    pdf.text(`${formatCurrency(invoice.stamp_tax) || '-'}`, pdf.internal.pageSize.width - 20, nextY, { align: 'right' });
    nextY += 10;
  }
  
  // Draw separator line above total
  pdf.setDrawColor(hexToRgb(darkGray).r, hexToRgb(darkGray).g, hexToRgb(darkGray).b);
  pdf.line(pdf.internal.pageSize.width - 75, nextY - 2, pdf.internal.pageSize.width - 15, nextY - 2);
  
  // Add total amount in larger, bold font
  pdf.setFont("helvetica", "bold");
  pdf.setTextColor(hexToRgb(primaryColor).r, hexToRgb(primaryColor).g, hexToRgb(primaryColor).b);
  pdf.setFontSize(12);
  pdf.text("Total TTC:", pdf.internal.pageSize.width - 75, nextY + 5);
  
  // Add the amount values aligned to the right
  pdf.setFont("helvetica", "normal");
  pdf.setTextColor(darkGray);
  pdf.setFontSize(9);
  pdf.text(formatCurrency(tdiscount), pdf.internal.pageSize.width - 20, startY + 10, { align: 'right' });
  pdf.text(formatCurrency(invoice.subtotal), pdf.internal.pageSize.width - 20, startY + 17, { align: 'right' });
  pdf.text(formatCurrency(invoice.taxTotal), pdf.internal.pageSize.width - 20, startY + 24, { align: 'right' });
  
  // Add total with primary color
  pdf.setFont("helvetica", "bold");
  pdf.setTextColor(hexToRgb(primaryColor).r, hexToRgb(primaryColor).g, hexToRgb(primaryColor).b);
  pdf.setFontSize(12);
  pdf.text(formatCurrency(invoice.total), pdf.internal.pageSize.width - 20, nextY + 5, { align: 'right' });
  
  return nextY + 22;
};

// Add notes section with styled design
const addNotes = (pdf: jsPDF, notes: string | undefined, startY: number) => {
  if (true) return startY;
  
  const lightYellow = "#FEF9C3";  // Light yellow for note background
  const darkBrown = "#78350F";    // Dark brown for note text
  
  // Notes title
  pdf.setFont("helvetica", "bold");
  pdf.setFontSize(10);
  pdf.setTextColor(darkBrown);
  pdf.text("NOTES:", 14, startY + 5);
  
  // Notes content
  pdf.setFont("helvetica", "normal");
  pdf.setFontSize(9);
  
  // Draw light yellow background
  drawRoundedRect(pdf, 14, startY + 7, 180, 20, 3, lightYellow);
  
  // Split notes into lines to fit the page width
  const splitNotes = pdf.splitTextToSize(notes, 170);
  pdf.text(splitNotes, 19, startY + 15);
  
  return startY + 33;
};

const addAmountInWords = (pdf: jsPDF, amount: number, startY: number) => {
  const lightGreen = "#457B9D";  // Light green background
  const darkGreen = "#003049";   // Text color
  
  // Set font properties first to calculate text width
  pdf.setFont("helvetica", "bold");
  pdf.setFontSize(9);
  
  // Generate the text
  const totalInWords = formatCurrencyInFrenchWords(amount);
  const fullText = `| ${totalInWords}.`;
  
  // Calculate text width
  const textWidth = pdf.getStringUnitWidth(fullText) * 9 / pdf.internal.scaleFactor;
  
  // Set rectangle dimensions
  const padding = 10; // 5px padding on each side
  const rectWidth = textWidth + padding;
  const rectHeight = 19;
  
  // Draw backgroun d (now with dynamic width)
//  drawRoundedRect(pdf, 14, startY, rectWidth, rectHeight, 3, lightGreen);
  pdf.setDrawColor(220, 220, 220);
  //pdf.line(        rectWidth,startY + 9,rectHeight,        startY + 9);
  // Add text (centered in the rectangle)
  pdf.setTextColor(darkGreen);
  pdf.text(`Montant en lettres:`, 14 + (rectWidth / 2) - (textWidth / 2), startY + 7);
  pdf.line(rectWidth,startY + 9, rectHeight ,startY + 9);
  pdf.text(toTitleCase(fullText), 14 + (rectWidth / 2) - (textWidth / 2), startY + 13);
  
  return startY + rectHeight + 3; // Return new Y position with some margin
};

// Add footer with thank you message
const addFooter = (pdf: jsPDF) => {
  
};
 
// PROFORMA INVOICE EXPORT
export const exportProformaInvoiceToPDF = async (proforma: ProformaInvoice) => {
  const pdf = new jsPDF();

  const maxRowsPerPage = 5;
  const chunkArray = <T>(arr: T[], size: number): T[][] =>
    Array.from({ length: Math.ceil(arr.length / size) }, (_, i) => arr.slice(i * size, i * size + size));

  // Chunked item rows
  let counter = 0;
  const itemRows = proforma.items.map(item => [
    (++counter).toString(),
    item.product?.code.toString(),
    `${item.product?.name || ''}\n${item.product?.description || ''}`,
    item.quantity.toString(),
    item.unit ? item.unit.toString() : '-',
    formatCurrency(item.unitprice),
    `${item.taxrate}%`,
    formatCurrency(item.totalExcl),
  ]);
  const tdiscount = proforma.items.reduce((acc, item) => acc + (item.discount || 0), 0);
  const itemChunks = chunkArray(itemRows, maxRowsPerPage);

  let currentY = 3;
  let pageIndex = 0;
  let lastTableY = 0;

  for (const chunk of itemChunks) {
    if (pageIndex > 0) pdf.addPage();

    const { yPos } = await addHeader(pdf, "FACTURE PROFORMA", proforma.number, proforma.status, proforma);
    currentY = yPos;
    currentY = addClientInfo(pdf, proforma.client, proforma, yPos);


    const tableY = addStylizedTable(
      pdf,
      ['No', 'code' , 'Produit', 'QtÃ©', 'UnitÃ©', 'Prix unitaire', 'TVA %',  'Prix HT'],
      chunk,
      currentY + 3
    );
    lastTableY = tableY;
    let yAfterTable = lastTableY + 10;
    const totalsY = addTotals(pdf, proforma, yAfterTable,tdiscount);
    const wordsY = addAmountInWords(pdf, proforma.total, yAfterTable +15);
    const notesY = addNotes(pdf, proforma.notes, wordsY);
    
    pageIndex++;
  }

  // Add page numbers
  const pageCount = pageIndex;
  for (let i = 1; i <= pageCount; i++) {
    pdf.setPage(i);
    pdf.setFontSize(8);
    pdf.setTextColor(100, 100, 100);
    pdf.text(`Page ${i} of ${pageCount}`, 105, pdf.internal.pageSize.height - 10, { align: 'center' });
  }
  // Totals, amount in words, and notes go on last page
 

  addFooter(pdf);
  pdf.save(`Proforma_${proforma.number}.pdf`);
  return true;
};


// FINAL INVOICE EXPORT
export const exportFinalInvoiceToPDF = async (invoice: FinalInvoice) => {
  
  const deliveryNotes = await mockDataService.getDeliveryNotesByFinalInvoiceId(invoice.id);
  const pdf = new jsPDF();

  const maxRowsPerPage = 5;
  const chunkArray = <T>(arr: T[], size: number): T[][] =>
    Array.from({ length: Math.ceil(arr.length / size) }, (_, i) => arr.slice(i * size, i * size + size));

  // Prepare item rows
  let counter = 0;
  const itemRows = invoice.items.map(item => [
    (++counter).toString(),
    item.product?.code.toString(),
    `${item.product?.name || ''}\n${item.product?.description || ''}`,
    item.quantity.toString(),
    item.unit ? item.unit.toString() : '-',
    formatCurrency(item.unitprice),
    formatCurrency(item.totalExcl)
  ]);
  const tdiscount = invoice.items.reduce((acc, item) => acc + (item.discount || 0), 0);
  const itemChunks = chunkArray(itemRows, maxRowsPerPage);
  let currentY = 3;
  let pageIndex = 0;
  let lastTableY = 0;
  let notesYY =0;

  for (const chunk of itemChunks) {
    if (pageIndex > 0) pdf.addPage();

    const { yPos } = await addHeader(pdf, "FACTURE ", invoice.number, invoice.status, invoice);
    currentY = yPos;

    if (pageIndex === 0) {
      currentY = addClientInfo(pdf, invoice.client, invoice, yPos);
    }

    const tableY = addStylizedTable(
      pdf,
      ['No', 'code' , 'Produit', 'QtÃ©', 'UnitÃ©', 'Prix unitaire',  'Prix HT'],
      chunk,
      currentY + 3
    );

    lastTableY = tableY;
    let yAfterTable = lastTableY + 10;
    const totalsY = addTotals(pdf, invoice, yAfterTable,tdiscount);
    const wordsY = addAmountInWords(pdf, invoice.total, yAfterTable +15);
    const notesY = addNotes(pdf, invoice.notes, wordsY);
    notesYY = wordsY;
    if (deliveryNotes && deliveryNotes.length > 0) {
        let yPosition=yAfterTable;
        pdf.setFontSize(12);
        pdf.setFont('helvetica');
        pdf.text('Bons de livraison associÃ©s:', 20, yPosition);
        yPosition += 5;
        
        pdf.setFontSize(10);
        pdf.setFont('helvetica', 'normal');
        
        // Create a string with all delivery note numbers separated by commas
        const deliveryNoteNumbers = deliveryNotes.map(note => note.number).join(', ');
        
        // Display just the numbers
        pdf.text(deliveryNoteNumbers, 20, yPosition);
        
        // Update yPosition for next content
    }
    pageIndex++;
  }

  // On last page: totals, words, notes, payments
  
  

  addFooter(pdf);
  pdf.save(`Invoice_${invoice.number}.pdf`);
  return true;
};


// DELIVERY NOTE EXPORT
export const exportDeliveryNoteToPDF = async (deliveryNote: DeliveryNote) => {
  const pdf = new jsPDF();

  const maxRowsPerPage = 5;
  const chunkArray = <T>(arr: T[], size: number): T[][] =>
    Array.from({ length: Math.ceil(arr.length / size) }, (_, i) => arr.slice(i * size, i * size + size));

  // Prepare table data
  let counter = 0;
  const itemRows = deliveryNote.items.map(item => [
    (++counter).toString(),
    item.product?.code.toString(),
    `${item.product?.name || 'N/A'}\n${item.product?.description || ''}`,
    item.quantity.toString(),
    item.unit ? item.unit.toString() : 'N/A'
  ]);
  const itemChunks = chunkArray(itemRows, maxRowsPerPage);

  const primaryColor = "#3B82F6";
  const lightPurple = "#EEF2FF";
  const darkPurple = "#4F46E5";

  let currentY = 10;
  let pageIndex = 0;
  let lastTableY = 0;

  for (const chunk of itemChunks) {
    if (pageIndex > 0) pdf.addPage();

    const { yPos } = await addHeader(pdf, "BON DE LIVRAISON", deliveryNote.number, deliveryNote.status , deliveryNote);
    currentY = yPos;
    currentY = addClientInfo(pdf, deliveryNote.client, deliveryNote, yPos);

   
    const tableY = addStylizedTable(
      pdf,
      ['No','code', 'Produit', 'QuantitÃ©', 'UnitÃ©'],
      chunk,
      currentY + 4
    );

    lastTableY = tableY;
     // Add transport details
    if (deliveryNote.drivername || deliveryNote.truck_id || deliveryNote.delivery_company) {
      const pdfFontSize = 9;
      const linePadding = 5;
      const rowSpacing = 4;

      pdf.setFont("helvetica", "normal");
      pdf.setFontSize(pdfFontSize);

      const labels = ["Entreprise de transport","Chauffeur","NÂ° permi","NÂ° tel", "Matricule" ];
      const values = [
        deliveryNote.delivery_company || "-",
        deliveryNote.drivername || "-",
        deliveryNote.driverlisence || "-",
        deliveryNote.drivertel || "-",
        deliveryNote.truck_id || "-",
        
      ];

      // Measure max width of label and value
      const labelWidths = labels.map(label => pdf.getTextWidth(label));
      const valueWidths = values.map(value => pdf.getTextWidth(value));

      const maxLabelWidth = Math.max(...labelWidths);
      const maxValueWidth = Math.max(...valueWidths);

      const col1Width = maxLabelWidth + linePadding;
      const col2Width = maxValueWidth + linePadding;

      const tableWidth = col1Width + col2Width + 5;
      const tableHeight = (labels.length * rowSpacing) + 6;

      const boxX = 14;
      const boxY = lastTableY +7;

      // Draw background box
      drawRoundedRect(pdf, boxX, boxY, tableWidth, tableHeight, 3, lightPurple);

      // Add title
      
      
      
      

      // Draw content rows
      pdf.setFont("helvetica", "normal");
      pdf.setFontSize(pdfFontSize);
      pdf.setTextColor(0, 0, 0);

      labels.forEach((label, i) => {
        const rowY = boxY + 6 + (i * rowSpacing);
        pdf.text(label, boxX + 2, rowY);
        pdf.text(values[i], boxX + col1Width + 2, rowY);
      });

      currentY = tableHeight + 10;
    }
      // Add notes and signature on last page
    const notesY = addNotes(pdf, deliveryNote.notes, currentY + 10);
    const signatureY = lastTableY + currentY +5;

    pdf.setFont("helvetica", "normal");
    pdf.setFontSize(10);
    pdf.setTextColor(59, 130, 246);

    // Signature lines
    
    
    drawRoundedRect(pdf, 14, signatureY, 60, 40, 3,'#FFFFFF' ,'#003049');

    pdf.text("Recu par:", 30, signatureY + 10);
    

    pageIndex++;
  }

  
  addFooter(pdf);
  pdf.save(`DeliveryNote_${deliveryNote.number}.pdf`);
  return true;
};


// ETAT 104 REPORT EXPORTS
interface ClientSummary {
  clientid: string;
  clientName: string;
  taxid: string;
  subtotal: number;
  taxTotal: number;
  total: number;
}

export const exportEtat104ToPDF = async (
  clientSummaries: ClientSummary[], 
  year: string, 
  month: string,
  totalAmount: number,
  totalTax: number,
  grandTotal: number
) => {
  const pdf = new jsPDF();
  
  // Add company header
  const companyInfo = await fetchCompanyInfo();
  
  // Define colors for report
  const primaryColor = "#3B82F6";  // Blue
  const secondaryColor = "#6366F1"; // Indigo
  
  // Add colored header banner
  const gradientHeight = 15;
  pdf.setFillColor(hexToRgb(primaryColor).r, hexToRgb(primaryColor).g, hexToRgb(primaryColor).b);
  pdf.rect(0, 0, pdf.internal.pageSize.width, gradientHeight, 'F');
  
  // Add company name
  pdf.setFont("helvetica", "bold");
  pdf.setTextColor(50, 50, 50);
  pdf.setFontSize(18);
  pdf.text(companyInfo?.businessName || 'YOUR COMPANY NAME', 105, 25, { align: 'center' });
  
  // Add company details
  pdf.setFont("helvetica", "normal");
  pdf.setFontSize(10);
  pdf.setTextColor(70, 70, 70);
  
  const companyDetails = [
    companyInfo?.address || 'Company Address',
    `NIF: ${companyInfo?.taxid || 'N/A'} | RC: ${companyInfo?.commerceRegNumber || 'N/A'}`,
    `Tel: ${companyInfo?.phone || 'N/A'} | Email: ${companyInfo?.email || 'info@company.com'}`
  ];
  
  pdf.text(companyDetails, 105, 30, { align: 'center' });
  
  // Add report title
  pdf.setFont("helvetica", "bold");
  pdf.setFontSize(16);
  pdf.setTextColor(hexToRgb(primaryColor).r, hexToRgb(primaryColor).g, hexToRgb(primaryColor).b);
  pdf.text(`ÃTAT 104 REPORT - ${month}/${year}`, 105, 50, { align: 'center' });
  
  // Add report subtitle
  pdf.setFont("helvetica", "italic");
  pdf.setFontSize(12);
  pdf.setTextColor(100, 100, 100);
  pdf.text('TVA de mois', 105, 58, { align: 'center' });
  
  // Prepare table data
  const tableRows = clientSummaries.map(summary => [
    summary.clientName,
    summary.taxid,
    formatCurrency(summary.subtotal),
    formatCurrency(summary.taxTotal),
    formatCurrency(summary.total)
  ]);
  
  // Add totals row with bold styling
  tableRows.push([
    'TOTALS',
    '',
    formatCurrency(totalAmount),
    formatCurrency(totalTax),
    formatCurrency(grandTotal)
  ]);
  
  // Add data table
  const tableY = addStylizedTable(
    pdf,
    ['Client', 'NIF', 'Montant (HT)', 'TVA', 'Total'],
    tableRows,
    70
  );
  
  // Add summary section with styled box
  const summaryY = tableY + 20;
  
  // Draw summary box with light background
  drawRoundedRect(pdf, 40, summaryY, 130, 60, 3, "#F0F9FF"); // Light blue background
  
  pdf.setFont("helvetica", "bold");
  pdf.setFontSize(14);
  pdf.setTextColor(hexToRgb(primaryColor).r, hexToRgb(primaryColor).g, hexToRgb(primaryColor).b);
  pdf.text('resumÃ© Ãtat 104', 105, summaryY + 10, { align: 'center' });
  
  pdf.setFont("helvetica", "normal");
  pdf.setFontSize(11);
  pdf.setTextColor(70, 70, 70);
  
  const detailsY = summaryY + 20;
  pdf.text('Total vente (Excl. Tax):', 60, detailsY);
  pdf.text('Total TVA :', 60, detailsY + 10);
  pdf.text('Total TVA  (simulÃ©):', 60, detailsY + 20);
  
  // Draw separator line
  pdf.setDrawColor(200, 200, 200);
  pdf.line(60, detailsY + 25, 150, detailsY + 25);
  
  // TVA due
  pdf.setFont("helvetica", "bold");
  pdf.setTextColor(hexToRgb(primaryColor).r, hexToRgb(primaryColor).g, hexToRgb(primaryColor).b);
  pdf.text('TVA Due:', 60, detailsY + 35);
  
  // Add amount values
  pdf.setFont("helvetica", "normal");
  pdf.setTextColor(70, 70, 70);
  pdf.text(formatCurrency(totalAmount), 150, detailsY, { align: 'right' });
  pdf.text(formatCurrency(totalTax), 150, detailsY + 10, { align: 'right' });
  pdf.text(formatCurrency(totalTax * 0.3), 150, detailsY + 20, { align: 'right' });
  
  // Add TVA due amount
  pdf.setFont("helvetica", "bold");
  pdf.setTextColor(hexToRgb(primaryColor).r, hexToRgb(primaryColor).g, hexToRgb(primaryColor).b);
  pdf.text(formatCurrency(totalTax * 0.7), 150, detailsY + 35, { align: 'right' });
  
  // Add compliance note
  pdf.setFont("helvetica", "italic");
  pdf.setFontSize(9);
  pdf.setTextColor(100, 100, 100);
  pdf.text('Note: This report is fully compliant with the Algerian tax authority requirements for G50 declarations.', 
    105, 
    summaryY + 70, 
    { align: 'center' }
  );
  
  // Add date of generation
  const today = new Date().toLocaleDateString('fr-DZ');
  pdf.setFont("helvetica", "normal");
  pdf.setFontSize(8);
  pdf.text(`Generated on: ${today}`, 105, pdf.internal.pageSize.height - 20, { align: 'center' });
  
  // Add page numbers
  const pageCount = pdf.internal.getNumberOfPages();
  for (let i = 1; i <= pageCount; i++) {
    pdf.setPage(i);
    pdf.setFontSize(8);
    pdf.setTextColor(100, 100, 100);
    pdf.text(`Page ${i} of ${pageCount}`, 105, pdf.internal.pageSize.height - 10, { align: 'center' });
  }
  
  // Save the PDF
  pdf.save(`Etat104_${month}_${year}.pdf`);
  return true;
};

export const exportEtat104ToExcel = (
  clientSummaries: ClientSummary[], 
  year: string, 
  month: string,
  totalAmount: number,
  totalTax: number,
  grandTotal: number
) => {
  // Prepare data for Excel
  const data = clientSummaries.map(summary => ({
    'Client': summary.clientName,
    'NIF': summary.taxid,
    'Montant (HT)': summary.subtotal,
    'TVA': summary.taxTotal,
    'Total': summary.total
  }));
  
  // Add totals row
  data.push({
    'Client': 'TOTALS:',
    'NIF': '',
    'Montant (HT)': totalAmount,
    'TVA': totalTax,
    'Total': grandTotal
  });
  
  // Create summary sheet data
  const summaryData = [
    { 'Summary': 'Total vente (HT):', 'Value': totalAmount },
    { 'Summary': 'Total TVA :', 'Value': totalTax },
    { 'Summary': 'Total TVA  (simule):', 'Value': totalTax * 0.3 },
    { 'Summary': 'TVA Due:', 'Value': totalTax * 0.7 }
  ];
  
  // Create workbook and worksheets
  const wb = XLSX.utils.book_new();
  
  // Main data sheet
  const ws = XLSX.utils.json_to_sheet(data);
  XLSX.utils.book_append_sheet(wb, ws, 'Ãtat 104 Data');
  
  // Summary sheet
  const summaryWs = XLSX.utils.json_to_sheet(summaryData);
  XLSX.utils.book_append_sheet(wb, summaryWs, 'Summary');
  
  // Save Excel file
  XLSX.writeFile(wb, `Etat104_${month}_${year}.xlsx`);
  return true;
};

// Helper function for status colors
function getStatusColor(status: string): string {
  switch (status) {
    case 'payÃ©':
    case 'approved':
    case 'livrÃ©e':
      return "#22C55E"; // Green
    case 'NonPayÃ©':
    case 'sent':
    case 'en_attente_de_livraison':
      return "#3B82F6"; // Blue
    case 'annulÃ©':
    case 'rejected':
      return "#EF4444"; // Red
    case 'credited':
    case 'draft':
    default:
      return "#94A3B8"; // Gray
  }
}

// Helper function to open a new window with HTML content for printing
export const openPrintableInvoice = (
  invoiceType: 'final' | 'proforma',
  invoiceId: string
) => {
  // Open a new tab/window with the printable invoice route - using v3 version
  const url = `/print/v3/${invoiceType}/${invoiceId}`;
  window.open(url, '_blank');
};